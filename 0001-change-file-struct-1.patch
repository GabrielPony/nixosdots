From 0dbe181f66ced3b24eab1728660fe2c06b97d138 Mon Sep 17 00:00:00 2001
From: Kony <aoengo@outlook.com>
Date: Wed, 27 Nov 2024 01:54:20 +0000
Subject: [PATCH] change file struct 1

---
 flake.nix                 | 10 +++++++---
 hosts/desktop/default.nix |  4 ++--
 hosts/laptop/default.nix  |  4 ++--
 hosts/wsl/default.nix     |  3 ++-
 modules/home/tmux.nix     | 22 +++++++++++-----------
 modules/home/zsh.nix      |  8 ++++----
 nixos/variables.nix       |  4 ++--
 pkgs/custom/nvim.nix      |  2 +-
 pkgs/custom/tmux.nix      |  2 +-
 pkgs/custom/zsh.nix       |  2 +-
 10 files changed, 33 insertions(+), 28 deletions(-)

diff --git a/flake.nix b/flake.nix
index 91de828..140e0a9 100644
--- a/flake.nix
+++ b/flake.nix
@@ -70,23 +70,27 @@
     let
       system = "x86_64-linux";
       lib = nixpkgs.lib;
+      pkgs = import nixpkgs {
+        inherit system;
+        config.allowUnfree = true; # 如果需要的话
+      };
     in
     {
       nixosConfigurations = {
         desktop = nixpkgs.lib.nixosSystem {
           inherit system;
           modules = [ (import ./hosts/desktop) ];
-          specialArgs = { host = "desktop"; inherit self inputs lib; };
+          specialArgs = { host = "desktop"; inherit self inputs lib pkgs; };
         };
         laptop = nixpkgs.lib.nixosSystem {
           inherit system;
           modules = [ (import ./hosts/laptop) ];
-          specialArgs = { host = "laptop"; inherit self inputs lib; };
+          specialArgs = { host = "laptop"; inherit self inputs lib pkgs; };
         };
         wsl = nixpkgs.lib.nixosSystem {
           inherit system;
           modules = [ (import ./hosts/wsl) ];
-          specialArgs = { host = "wsl"; inherit self inputs lib; };
+          specialArgs = { host = "wsl"; inherit self inputs lib pkgs; };
         };
       };
     };
diff --git a/hosts/desktop/default.nix b/hosts/desktop/default.nix
index 49fbde4..80e045b 100644
--- a/hosts/desktop/default.nix
+++ b/hosts/desktop/default.nix
@@ -1,8 +1,8 @@
-{ inputs, lib, system, ... }:
+{ pkgs, inputs, lib, ... }:
 {
   imports = [
     inputs.stylix.nixosModules.stylix
-    inputs.pia.nixosModules.${system}.default
+    inputs.pia.nixosModules.${pkgs.system}.default
     ./../../nixos/variables.nix
     ./addon-configuration.nix
     ./hardware-configuration.nix
diff --git a/hosts/laptop/default.nix b/hosts/laptop/default.nix
index f075750..e945f5a 100644
--- a/hosts/laptop/default.nix
+++ b/hosts/laptop/default.nix
@@ -1,8 +1,8 @@
-{ inputs, lib, system, ... }:
+{ pkgs, inputs, lib, ... }:
 {
   imports = [
     inputs.stylix.nixosModules.stylix
-    inputs.pia.nixosModules."x86_64-linux".default
+    inputs.pia.nixosModules.${pkgs.system}.default
     ./../../nixos/variables.nix
     ./addon-configuration.nix
     ./hardware-configuration.nix
diff --git a/hosts/wsl/default.nix b/hosts/wsl/default.nix
index c1cf341..cb27980 100644
--- a/hosts/wsl/default.nix
+++ b/hosts/wsl/default.nix
@@ -1,8 +1,9 @@
-{ inputs, lib, ... }:
+{ pkgs, inputs, lib, ... }:
 {
   imports = [
     # include NixOS-WSL modules
     inputs.nixos-wsl.nixosModules.wsl
+    inputs.pia.nixosModules.${pkgs.system}.default
     ./../../nixos/variables.nix
     ./addon-configuration.nix
     ./../../modules/core/default.mini.nix
diff --git a/modules/home/tmux.nix b/modules/home/tmux.nix
index 22ecfe3..a2db6a4 100644
--- a/modules/home/tmux.nix
+++ b/modules/home/tmux.nix
@@ -1,6 +1,6 @@
-{ pkgs, lib, ... }:
+{ uconfig, pkgs, lib, ... }:
 let
-  tmux-config = pkgs.callPackage ./../../pkgs/custom/tmux.nix {};
+  tmux-config = pkgs.callPackage ./../../pkgs/custom/tmux.nix { inherit uconfig; };
 in
 {
   home.packages = (with pkgs; [
@@ -10,16 +10,16 @@ in
   ]);
 
   home.activation = {
-  linkTmuxConfig = lib.hm.dag.entryAfter ["writeBoundary"] ''
-    # 清理旧的链接（可选）
-    $DRY_RUN_CMD rm -rf $HOME/.config/tmux
-    $DRY_RUN_CMD mkdir -p $HOME/.config/tmux
+    linkTmuxConfig = lib.hm.dag.entryAfter [ "writeBoundary" ] ''
+      # 清理旧的链接（可选）
+      $DRY_RUN_CMD rm -rf $HOME/.config/tmux
+      $DRY_RUN_CMD mkdir -p $HOME/.config/tmux
 
-    # 创建软链接
-    $DRY_RUN_CMD cp ${tmux-config}/config/.tmux.conf.local "$HOME/.config/tmux/tmux.conf.local"
-    $DRY_RUN_CMD ln -sf ${tmux-config}/config/.tmux.conf "$HOME/.config/tmux/tmux.conf"
-    $DRY_RUN_CMD chmod 755 $HOME/.config/tmux/tmux.conf.local
-  '';
+      # 创建软链接
+      $DRY_RUN_CMD ln -sf ${tmux-config}/config/.tmux.conf.local "$HOME/.config/tmux/tmux.conf.local"
+      $DRY_RUN_CMD ln -sf ${tmux-config}/config/.tmux.conf "$HOME/.config/tmux/tmux.conf"
+      #$DRY_RUN_CMD chmod 755 $HOME/.config/tmux/tmux.conf.local
+    '';
   };
 
   # home.file.".config/tmux/tmux.conf.local".source = "${tmux-config}config/.tmux.conf.local";
diff --git a/modules/home/zsh.nix b/modules/home/zsh.nix
index 9c4e1d1..36bfc4c 100644
--- a/modules/home/zsh.nix
+++ b/modules/home/zsh.nix
@@ -1,6 +1,6 @@
-{ hostname, pkgs, host, lib,...}:
+{ uconfig, pkgs, host, lib, ... }:
 let
-  zsh-config = pkgs.callPackage ./../../pkgs/custom/zsh.nix {};
+  zsh-config = pkgs.callPackage ./../../pkgs/custom/zsh.nix { inherit uconfig; };
 in
 {
   programs.fzf.enable = true;
@@ -15,9 +15,9 @@ in
     syntaxHighlighting.enable = true;
     oh-my-zsh = {
       enable = true;
-      plugins = [ "git" "fzf"];
+      plugins = [ "git" "fzf" ];
       custom = "$HOME/.config/.oh-my-zsh/custom"; # 自定义目录
-      theme ="powerlevel10k/powerlevel10k";
+      theme = "powerlevel10k/powerlevel10k";
     };
     initExtra = ''
       # This will add to .zshrc
diff --git a/nixos/variables.nix b/nixos/variables.nix
index bf7b401..2e0b6c6 100644
--- a/nixos/variables.nix
+++ b/nixos/variables.nix
@@ -6,7 +6,7 @@
 
     # system = "x86_64-linux";
     hostname = "nixos";
-    username = "gabriel";
+    username = "kony";
     password = "1111";
 
     # The path of the nixos configuration directory
@@ -33,7 +33,7 @@
         owner = "GabrielPony"; # 替换为你的 GitHub 用户名
         name = "dotfiles"; # 替换为你的仓库名
         rev = "main"; # 可以是分支名、tag 或 commit hash
-        sha256 = "sha256-K9A443WOXdonzSLxXYwztrVJA3kOtPirMMuS4MzFtP0=";
+        sha256 = "sha256-2SO+mrGg1zm0fKnCrzfYCGu/7hNbOWx4FvPTwPnVz14=";
       };
     };
   };
diff --git a/pkgs/custom/nvim.nix b/pkgs/custom/nvim.nix
index d2a7ebf..8deb127 100644
--- a/pkgs/custom/nvim.nix
+++ b/pkgs/custom/nvim.nix
@@ -1,7 +1,7 @@
 { stdenv, uconfig, fetchFromGitHub, ... }:
 let
 repo-owner = uconfig.custom.repo.owner;
-repo-name = uconfig.custom.repo.repo;
+repo-name = uconfig.custom.repo.name;
 repo-rev = uconfig.custom.repo.rev;
 repo-sha256 = uconfig.custom.repo.sha256;
 in
diff --git a/pkgs/custom/tmux.nix b/pkgs/custom/tmux.nix
index cc4ca59..c3c84a7 100644
--- a/pkgs/custom/tmux.nix
+++ b/pkgs/custom/tmux.nix
@@ -1,7 +1,7 @@
 { stdenv, uconfig, fetchFromGitHub, ... }:
 let
 repo-owner = uconfig.custom.repo.owner;
-repo-name = uconfig.custom.repo.repo;
+repo-name = uconfig.custom.repo.name;
 repo-rev = uconfig.custom.repo.rev;
 repo-sha256 = uconfig.custom.repo.sha256;
 in
diff --git a/pkgs/custom/zsh.nix b/pkgs/custom/zsh.nix
index 84cfc48..2bc1fd1 100644
--- a/pkgs/custom/zsh.nix
+++ b/pkgs/custom/zsh.nix
@@ -1,7 +1,7 @@
 { stdenv, uconfig, fetchFromGitHub, ... }:
 let
 repo-owner = uconfig.custom.repo.owner;
-repo-name = uconfig.custom.repo.repo;
+repo-name = uconfig.custom.repo.name;
 repo-rev = uconfig.custom.repo.rev;
 repo-sha256 = uconfig.custom.repo.sha256;
 in
-- 
2.47.0

